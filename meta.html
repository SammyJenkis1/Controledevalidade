<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ChocoPrime ‚Ä¢ Dashboard Financeiro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#faf7f5; --card:#ffffff; --ink:#3b2a28; --muted:#8a7068;
  --brand-a:#c07a57; --brand-b:#8c4a3e; --ok:#2e7d32; --bad:#b00020;
  --ring:#e3d4cc; --shadow:0 6px 22px rgba(75,46,43,.12);
  --highlight: rgba(192,122,87,.15);
  --glass: rgba(255,255,255,0.6);
}
@media(prefers-color-scheme:dark){
  :root{ --bg:#1e1716; --card:#241b19; --ink:#efe7e5; --muted:#cdbdb7; --ring:#3b2a26; --shadow:0 10px 24px rgba(0,0,0,.35) }
}

*{box-sizing:border-box}
body{font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink)}
.container{max-width:1150px;margin:28px auto;padding:18px}
h1{margin:0 0 18px;font-weight:800;font-size:28px}
h2{margin:0 0 12px;font-weight:700;font-size:16px}

.card{padding:18px;background:linear-gradient(145deg,var(--card),#f6eee9);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);margin-bottom:18px;transition:.25s}
.card:hover{box-shadow:0 12px 30px rgba(75,46,43,.18)}

.toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
.btn{padding:10px 14px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--brand-a),var(--brand-b));color:#fff;font-weight:800;cursor:pointer;transition:.16s}
.btn.secondary{background:#efe3dc;color:#6a3b32;border:1px solid var(--ring)}
.btn.ghost{background:transparent;color:var(--ink);border:1px dashed var(--ring)}
.btn:hover{transform:translateY(-2px);opacity:.94}

.grid{display:grid;gap:16px}
@media(min-width:980px){ .grid{grid-template-columns:1.2fr .8fr} }

.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{font-size:13px;padding:7px 10px;border-radius:999px;border:1px solid var(--ring);background:#fff}
.bad{color:var(--bad)} .ok{color:var(--ok)} .warn{color:#b26a00}

/* --- floating inputs (material-like) --- */
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.field{position:relative;min-width:140px}
.field input{width:100%;padding:14px 12px 10px 12px;border-radius:10px;border:1px solid var(--ring);background:#fff;font-weight:600}
.field label{position:absolute;left:12px;top:10px;font-size:12px;color:var(--muted);pointer-events:none;transition:all .16s}
.field input:focus + label,
.field input:not(:placeholder-shown) + label{top:-8px;font-size:11px;color:var(--brand-b);background:transparent;padding:0 6px}
@media(prefers-color-scheme:dark){ .field input{background:#2a201e;color:var(--ink)} }

/* daily inputs grid */
#inputsDias{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:10px}
.daycell{display:flex;flex-direction:column;gap:6px;background:#fff;border:1px solid var(--ring);border-radius:12px;padding:8px;transition:.12s}
.daycell strong{font-size:12px;color:var(--muted);letter-spacing:.2px}
.daycell input{border-radius:8px;padding:10px;border:1px solid var(--ring);font-weight:700}

/* chart wrap + drips overlay */
.chart-wrap{position:relative;height:360px}
canvas{display:block;width:100%;height:100%;border-radius:12px;background:transparent}

/* "drip" effect elements (chocolate) */
.drips{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;overflow:visible}
.drip{position:absolute;left:0;top:0;width:8px;height:0;background:linear-gradient(180deg,var(--brand-b),#3b2118);border-radius:6px;opacity:.95;transform-origin:top center;box-shadow:0 6px 16px rgba(0,0,0,.18)}
@keyframes dripDown{
  0%{height:0;transform:translateY(0) scaleX(.9)}
  60%{height:40px;transform:translateY(0) scaleX(1)}
  100%{height:100px;transform:translateY(40px) scaleX(.95);opacity:0}
}

/* stats grid */
.stat{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
.stat div{background:#fff;border:1px solid var(--ring);border-radius:10px;padding:10px}
.stat b{display:block;font-size:12px;color:var(--muted)}
.stat span{font-weight:800}

/* ranking and list */
ol, ul{margin:8px 0 0 18px}

/* toast */
.toast{position:fixed;right:20px;bottom:20px;background:linear-gradient(90deg,var(--brand-a),var(--brand-b));color:#fff;padding:12px 16px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.25);font-weight:700;z-index:9999;opacity:0;transform:translateY(10px);transition:all .36s}
.toast.show{opacity:1;transform:translateY(0)}
</style>
</head>
<body>
<div class="container">
  <h1>Dashboard Financeiro - Setembro (Melhorado)</h1>

  <div class="card">
    <h2>Controles</h2>
    <div class="toolbar">
      <div class="field"><input id="metaBaseInput" type="number" step="0.01" placeholder=" " /><label>Meta base di√°ria (R$)</label></div>
      <div class="field"><input id="metaMesInput" type="number" step="0.01" placeholder=" " /><label>Meta mensal (R$)</label></div>
      <button class="btn" id="aplicarMetas">Aplicar metas</button>
      <button class="btn secondary" id="redistribuir">Distribuir falta</button>
      <button class="btn ghost" id="resetar">Resetar m√™s</button>
      <label class="small">Importar CSV: <input id="fileCSV" type="file" accept=".csv"></label>
      <button class="btn" id="exportarCSV">Exportar CSV</button>
      <button class="btn ghost" onclick="window.print()">Imprimir</button>
    </div>

    <div class="chips" style="margin-top:10px">
      <span class="chip" id="chipDiasRestantes"></span>
      <span class="chip" id="chipFaltaDia"></span>
      <span class="chip" id="chipMelhorDia"></span>
      <span class="chip" id="chipPiorDia"></span>
      <span class="chip" id="chipTicket">Ticket m√©dio: ‚Äî</span>
    </div>
  </div>

  <div class="grid">
    <div>
      <div class="card">
        <h2>Registrar realizado por dia</h2>
        <div id="inputsDias"></div>
        <div class="toolbar" style="margin-top:10px">
          <button class="btn" id="atualizar">Atualizar Gr√°fico</button>
          <button class="btn secondary" id="preencherMeta">Preencher com meta base</button>
          <button class="btn" id="preencherDia01">Preencher com meta Dia 01</button>
        </div>
      </div>

      <div class="card">
        <h2>Progresso di√°rio √ó Meta ajustada</h2>
        <div class="chart-wrap">
          <canvas id="dailyChart"></canvas>
          <div class="drips" id="drips"></div>
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <h2>Resumo do m√™s</h2>
        <div class="stat">
          <div><b>Meta do m√™s</b><span id="metaMesTxt">R$ 80.574,80</span></div>
          <div><b>Realizado</b><span id="realizadoTxt">R$ 0,00</span></div>
          <div><b>Falta</b><span id="faltaTxt">R$ 0,00</span></div>
          <div><b>Previs√£o de fechamento</b><span id="forecastTxt">R$ 0,00</span></div>
        </div>
        <div class="progress" style="margin-top:12px;height:28px;background:#eae0d9;border-radius:16px;overflow:hidden">
          <i id="bar" style="display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--brand-a),var(--brand-b));text-align:center;line-height:28px;color:#fff;font-weight:800;transition:width .8s"></i>
        </div>
        <p id="proxMeta" style="margin-top:10px"><b>Pr√≥xima meta estimada:</b> R$ 0,00</p>
      </div>

      <div class="card">
        <h2>Ranking (Top 5)</h2>
        <ol id="ranking"></ol>
      </div>

      <div class="card">
        <h2>Resumo di√°rio</h2>
        <ul id="resumoDiario"></ul>
      </div>

      <div class="card" style="margin-top:12px">
        <h2>Indicadores semanais</h2>
        <div id="indicadoresSemanais"></div>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* ---------- Configuracoes inciais ---------- */
const diasMes = 30;
const dias = Array.from({length:diasMes}, (_,i)=>String(i+1).padStart(2,'0')+'/09');
const META_DIA01 = 2690.66;
const DEFAULT_META_BASE = 2685.83;
const DEFAULT_META_MES = 80574.80;

let vendasDia = JSON.parse(localStorage.getItem('vendasDia_v2')) || Object.fromEntries(dias.map(d=>[d,0]));
let metaMes = JSON.parse(localStorage.getItem('metaMes_v2')) ?? DEFAULT_META_MES;
let metaBase = JSON.parse(localStorage.getItem('metaBase_v2')) ?? DEFAULT_META_BASE;

/* elementos DOM */
const metaMesInput = document.getElementById('metaMesInput');
const metaBaseInput = document.getElementById('metaBaseInput');
metaMesInput.value = metaMes.toFixed(2);
metaBaseInput.value = metaBase.toFixed(2);
document.getElementById('metaMesTxt').textContent = money(metaMes);

/* montar inputs por dia */
const inputsWrap = document.getElementById('inputsDias');
inputsWrap.innerHTML = '';
dias.forEach(d=>{
  const cell = document.createElement('div');
  cell.className = 'daycell';
  cell.innerHTML = `<strong>${d}</strong><input type="text" inputmode="decimal" data-dia="${d}" value="${(vendasDia[d]||0).toFixed(2)}" />`;
  inputsWrap.appendChild(cell);
});
inputsWrap.addEventListener('input', (e)=>{
  if(e.target && e.target.dataset.dia){
    const dia = e.target.dataset.dia;
    vendasDia[dia] = parseNumber(e.target.value);
  }
});

/* ----- l√≥gica de meta ajustada (carrying deficits) ----- */
function metaDoDia(i){
  if(i===0) return META_DIA01;
  let carry = 0;
  for(let j=0;j<=i;j++){
    const meta = (j===0 ? META_DIA01 : DEFAULT_META_BASE) + carry;
    const realizado = vendasDia[dias[j]]||0;
    carry = Math.max(0, meta - realizado);
    if(j===i) return meta;
  }
}

/* gerar array de metas ajustadas */
function metasAjustadas(){
  return dias.map((d,i)=>metaDoDia(i));
}

/* acumulados e totais */
function acumulado(){ let soma=0, arr=[]; for(const d of dias){ soma += (vendasDia[d]||0); arr.push(soma); } return arr; }
function faltandoTotal(){ return Math.max(0, metaMes - totalVendido()); }
function diasRestantes(){ return dias.filter(d => (vendasDia[d]||0)===0).length; }
function totalVendido(){ return Object.values(vendasDia).reduce((a,b)=>a+Number(b||0),0); }

/* melhor e pior dia */
function melhorDia(){ return Object.entries(vendasDia).reduce((m,c)=>c[1]>m[1]?c:m,[dias[0],0]); }
function piorDia(){ return Object.entries(vendasDia).reduce((m,c)=>c[1]<m[1]?c:m,[dias[0],Infinity]); }

/* ---------- Chart.js ‚Äî gr√°fico com gradiente e anima√ß√£o ---------- */
const ctx = document.getElementById('dailyChart').getContext('2d');

/* helper para criar gradiente "chocolate" por barra */
function chocolateGradient(ctx, chartArea, value){
  const g = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
  g.addColorStop(0, '#3b2118'); // escuro
  g.addColorStop(0.45, '#8c4a3e');
  g.addColorStop(1, '#c07a57'); // clara
  return g;
}

/* plugin para colorir barras e atualizar gradientes no resize */
const gradientPlugin = {
  id: 'gradientPlugin',
  beforeDatasetsDraw(chart){
    const meta = chart.getDatasetMeta(0);
    if(!chart.chartArea) return;
    meta.data.forEach((bar, i)=>{
      const ctx = chart.ctx;
      const area = chart.chartArea;
      const grad = chocolateGradient(ctx, area, bar);
      // set dataset background per bar via direct fillStyle on ctx when drawing (we keep backgroundColor array)
      chart.data.datasets[0].backgroundColor[i] = grad;
    });
  }
};

/* inicial datasets */
let chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: dias,
    datasets: [
      { label:'Realizado', data: dias.map(d=>vendasDia[d]||0), backgroundColor: [], borderRadius:6, maxBarThickness:48 },
      { label:'Meta ajustada', data: metasAjustadas(), backgroundColor:'#e9d7cf', borderRadius:6, type:'bar' },
      { type:'line', label:'Acumulado', data: acumulado(), borderColor:'#c07a57', tension:.35, fill:false, pointRadius:3 }
    ]
  },
  options: {
    responsive:true,
    maintainAspectRatio:false,
    animation:{ duration:800, easing:'easeOutQuart', onComplete:()=>createDrips() },
    plugins: {
      legend:{position:'top'},
      tooltip:{mode:'index',intersect:false,callbacks:{label:(ctx)=> `${ctx.dataset.label}: ${money(ctx.raw)}`}}
    },
    scales:{
      x:{grid:{display:false}},
      y:{beginAtZero:true,ticks:{callback:(v)=> money(v)}}
    }
  },
  plugins: [gradientPlugin]
});

/* ---- fun√ß√£o que colore as barras (cores baseadas em meta vs realizado) ---- */
function colorirBarras(){
  const metas = metasAjustadas();
  const m = melhorDia()[0], p = piorDia()[0];
  const cores = dias.map((d,i)=>{
    if(d===m) return '#2e7d32';
    if(d===p) return '#b00020';
    return (vendasDia[d]||0) >= metas[i] ? '#4caf50' : '#8c4a3e';
  });
  // convert hex fallback to gradient handled by plugin ‚Äî keep array for border & quick fallback
  chart.data.datasets[0].backgroundColor = chart.data.datasets[0].backgroundColor.map((g, idx)=> g || cores[idx]);
}

/* ---------- drips (efeito derretimento) ---------- */
const dripsWrap = document.getElementById('drips');
function clearDrips(){ dripsWrap.innerHTML = ''; }
function createDrips(){
  // remove antigos
  clearDrips();
  // pegar meta info para posicionar
  const meta = chart.getDatasetMeta(0);
  if(!meta || !meta.data) return;
  meta.data.forEach((bar, i)=>{
    const barRect = bar.getProps(['x','y','base','width'], true);
    const barTopY = barRect.y;
    const barCenterX = barRect.x;
    // criar 0..2 drips por barra aleatoriamente (s√≥ para barras com altura suficiente)
    const heightPx = Math.max(0, barRect.base - barTopY);
    if(heightPx < 30) return; // muito pequeno para drips
    const dripCount = Math.random() > 0.6 ? 2 : 1;
    for(let k=0;k<dripCount;k++){
      const drip = document.createElement('div');
      drip.className = 'drip';
      const leftOffset = (Math.random()* (barRect.width*0.6)) - (barRect.width*0.3); // variar posicao
      drip.style.left = (barCenterX + leftOffset - 4) + 'px';
      drip.style.top = (barTopY + 4) + 'px';
      drip.style.width = (6 + Math.random()*6) + 'px';
      // delay e animation para parecer natural
      const delay = (Math.random()*600) + 'ms';
      drip.style.animation = `dripDown 1200ms ${delay} forwards`;
      dripsWrap.appendChild(drip);
    }
  });
  // auto remove drips after animation to keep DOM limpo
  setTimeout(()=>{ clearDrips(); }, 2200);
}

/* ---------- atualiza√ß√£o geral e persist√™ncia ---------- */
function atualizarTudo(notify=true){
  // salvar metas atuais
  localStorage.setItem('vendasDia_v2', JSON.stringify(vendasDia));
  localStorage.setItem('metaMes_v2', JSON.stringify(metaMes));
  localStorage.setItem('metaBase_v2', JSON.stringify(metaBase));
  // atualizar chart dados
  chart.data.datasets[0].data = dias.map(d=>vendasDia[d]||0);
  chart.data.datasets[1].data = metasAjustadas();
  chart.data.datasets[2].data = acumulado();
  colorirBarras();
  chart.update();
  atualizarResumo();
  if(notify) checkThresholds();
}

/* atualizar resumo textual */
function atualizarResumo(){
  const tot = totalVendido();
  const falta = faltandoTotal();
  const pct = Math.min(100, (tot/metaMes*100)) || 0;
  document.getElementById('realizadoTxt').textContent = money(tot);
  document.getElementById('faltaTxt').textContent = money(falta);
  const bar = document.getElementById('bar'); bar.style.width = pct.toFixed(1)+'%'; bar.textContent = pct.toFixed(1)+'%';

  const diasComVenda = Object.values(vendasDia).filter(v=>v>0).length || 1;
  const media = tot / diasComVenda;
  document.getElementById('forecastTxt').textContent = money(media*diasMes);

  for(let i=0;i<dias.length;i++){
    if((vendasDia[dias[i]]||0)===0){
      document.getElementById('proxMeta').innerHTML = `<b>Pr√≥xima meta estimada:</b> ${money(metaDoDia(i))}`;
      break;
    }
  }

  document.getElementById('chipDiasRestantes').textContent = `Dias restantes: ${diasRestantes()}`;
  document.getElementById('chipFaltaDia').textContent = `Falta por dia: ${diasRestantes()? money(falta/diasRestantes()): '‚Äî'}`;
  const m = melhorDia(), p = piorDia();
  document.getElementById('chipMelhorDia').textContent = `Melhor dia: ${m[0]} (${money(m[1])})`;
  document.getElementById('chipPiorDia').textContent = `Pior dia: ${p[0]} (${money(p[1])})`;
  document.getElementById('chipTicket').textContent = `Ticket m√©dio: ${money(ticketMedio())}`;

  atualizarResumoDiario();
  atualizarRanking();
  atualizarIndicadoresSemanais();
}

/* ranking e resumo di√°rio (mantidos) */
function atualizarRanking(){ const ol=document.getElementById('ranking'); ol.innerHTML=''; const top=Object.entries(vendasDia).sort((a,b)=>b[1]-a[1]).slice(0,5); top.forEach(([d,v])=>{ const li=document.createElement('li'); li.innerHTML=`<b>${d}</b> ‚Äî ${money(v)}`; ol.appendChild(li);}); }
function atualizarResumoDiario(){ const ul=document.getElementById('resumoDiario'); ul.innerHTML=''; let carry=0; for(let i=0;i<dias.length;i++){ const d=dias[i]; const meta=metaDoDia(i); const realizado=vendasDia[d]||0; const faltou=Math.max(0,meta-realizado); carry=faltou; const li=document.createElement('li'); li.className=faltou>0?'bad':'ok'; li.textContent=`${d} ‚Äî Realizado ${money(realizado)} | Meta ${money(meta)} ‚Üí ${faltou>0?'Faltou '+money(faltou):'OK'}`; ul.appendChild(li); } }

/* ---------- indicadores extras ---------- */
function ticketMedio(){ // m√©dia simples por dia vendedor (dias com venda)
  const arr = Object.values(vendasDia).filter(v=>v>0);
  if(arr.length===0) return 0;
  return arr.reduce((a,b)=>a+b,0)/arr.length;
}

/* calcular indicadores semanais: dividir m√™s em 5 blocos (6 dias cada) */
function atualizarIndicadoresSemanais(){
  const wrap = document.getElementById('indicadoresSemanais');
  wrap.innerHTML = '';
  const daysPerWeek = 6; // simples parti√ß√£o para 30 dias: 5 semanas x 6 dias
  for(let w=0; w<5; w++){
    const start = w*daysPerWeek;
    const slice = dias.slice(start, start+daysPerWeek);
    const realizado = slice.reduce((s,d)=>s+(vendasDia[d]||0),0);
    const metas = slice.map((d,i)=>metaDoDia(start+i)).reduce((a,b)=>a+b,0);
    const pct = metas ? Math.round((realizado/metas)*100) : 0;
    const div = document.createElement('div');
    div.style.display='flex'; div.style.justifyContent='space-between'; div.style.marginBottom='6px';
    div.innerHTML = `<div><b>Semana ${w+1}</b> ‚Äî ${slice[0]} ‚Üí ${slice[slice.length-1] || slice[0]}</div><div>${money(realizado)} / ${pct}%</div>`;
    wrap.appendChild(div);
  }
}

/* ---------- threshold notifications (50%,75%,100%) ---------- */
let thresholdsFired = JSON.parse(localStorage.getItem('thresholdsFired_v2')) || {50:false,75:false,100:false};
function checkThresholds(){
  const tot = totalVendido();
  const p = tot / metaMes * 100;
  if(p>=50 && !thresholdsFired[50]){ showToast('Parab√©ns! Voc√™ atingiu 50% da meta mensal üéâ'); thresholdsFired[50]=true; }
  if(p>=75 && !thresholdsFired[75]){ showToast('Top! Meta em 75% ‚Äî √≥timo trabalho üí™'); thresholdsFired[75]=true; }
  if(p>=100 && !thresholdsFired[100]){ showToast('Meta alcan√ßada! 100% batido ‚Äî bora al√©m! üèÜ'); thresholdsFired[100]=true; }
  localStorage.setItem('thresholdsFired_v2', JSON.stringify(thresholdsFired));
}
function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 3800);
}

/* ---------- CSV export / import ---------- */
document.getElementById('exportarCSV').onclick = ()=>{
  const metas = metasAjustadas(); let csv='Dia,Realizado,Meta Ajustada,Acumulado\n'; let acum=0;
  dias.forEach((d,i)=>{const v=vendasDia[d]||0; acum+=v; csv+=`${d},${v.toFixed(2)},${metas[i].toFixed(2)},${acum.toFixed(2)}\n`;});
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='chocoprime_sept.csv'; a.click();
};

document.getElementById('fileCSV').addEventListener('change',(e)=>{
  const file=e.target.files[0]; if(!file) return; const reader=new FileReader();
  reader.onload=()=>{
    const linhas=reader.result.split(/\r?\n/).filter(Boolean);
    linhas.slice(1).forEach(l=>{
      const [dia,val]=l.split(',').map(s=>s.trim());
      if(dias.includes(dia)){ vendasDia[dia]=parseNumber(val); const el=inputsWrap.querySelector(`input[data-dia="${dia}"]`); if(el) el.value=(vendasDia[dia]||0).toFixed(2); }
    });
    atualizarTudo();
  };
  reader.readAsText(file,'utf-8');
});

/* ---------- bot√µes e a√ß√µes ---------- */
document.getElementById('atualizar').onclick = ()=> atualizarTudo();
document.getElementById('preencherMeta').onclick = ()=>{ dias.forEach(d=>{ vendasDia[d]=metaBase; inputsWrap.querySelector(`input[data-dia="${d}"]`).value=metaBase.toFixed(2); }); atualizarTudo(); }
document.getElementById('preencherDia01').onclick = ()=>{ dias.forEach((d,i)=>{ const val = i===0?META_DIA01:metaBase; vendasDia[d]=val; inputsWrap.querySelector(`input[data-dia="${d}"]`).value=val.toFixed(2); }); atualizarTudo(); }
document.getElementById('aplicarMetas').onclick = ()=>{ metaBase = parseNumber(metaBaseInput.value) || DEFAULT_META_BASE; metaMes = parseNumber(metaMesInput.value) || DEFAULT_META_MES; document.getElementById('metaMesTxt').textContent = money(metaMes); atualizarTudo(true); }
document.getElementById('redistribuir').onclick = ()=> {
  const falta = faltandoTotal();
  const livres = dias.filter(d => (vendasDia[d]||0)===0);
  if(livres.length){ const porDia = falta/livres.length; livres.forEach(d=>{ vendasDia[d]=porDia; const el=inputsWrap.querySelector(`input[data-dia="${d}"]`); if(el) el.value = porDia.toFixed(2); }); atualizarTudo(true); }
};
document.getElementById('resetar').onclick = ()=> {
  if(confirm('Resetar todos os valores do m√™s?')){
    vendasDia = Object.fromEntries(dias.map(d=>[d,0]));
    inputsWrap.querySelectorAll('input[data-dia]').forEach(el=> el.value='0.00');
    thresholdsFired = {50:false,75:false,100:false};
    localStorage.setItem('thresholdsFired_v2', JSON.stringify(thresholdsFired));
    atualizarTudo(true);
  }
};

/* ---------- utilit√°rios ---------- */
function money(v){ return 'R$ '+(Number(v)||0).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function parseNumber(s){ if(typeof s==='number') return s; if(!s) return 0; return parseFloat(String(s).replace(/\./g,'').replace(',','.'))||0; }

/* ---------- boot ---------- */
function boot(){ colorirBarras(); chart.update(); atualizarResumo(); }
boot();

</script>
</body>
</html>
